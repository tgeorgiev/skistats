<!DOCTYPE html>
<html>
  <head>
    <title>skistats demo</title>
    <link href='http://fonts.googleapis.com/css?family=Maven+Pro' rel='stylesheet' type='text/css'>  
    <link rel="stylesheet" type="text/css" href="../dist/assets/skistats.css" />
    <link rel="stylesheet" type="text/css" href="assets/main.css" />
    <script>
      var BASE_STRATEGY_URL = "../dist/strategies/";
    </script>
    <script type="text/javascript" src="../bower_components/d3/d3.min.js"></script>
    <script type="text/javascript" src="../bower_components/raphael/raphael.js"></script>
    <script type="text/javascript" src="../dist/skistats.js"></script>
    <script type="text/javascript" src="../dist/strategies/livigno-strategy.js"></script>
    
    <script>
      function handleFileSelect(evt) {
        evt.stopPropagation();
        evt.preventDefault();

        var files = evt.dataTransfer.files; // FileList object.
        loadFiles(files, function(){
          document.getElementsByClassName('visualization')[0].style.display = '';
          document.getElementsByClassName('filesSelector')[0].style.display = 'none';

          skistats.withMap('.map')
            .withLiftLegend('.lifts')
            .withParticipantsLegend('.participants')
            .withTimeline('.timelineContainer');
          
          document.getElementsByClassName('resortName')[0].innerHTML = skistats.selectedSkiStrategy().name;
          
          var text = 'I just saw a ski statistics visualization of my ski pass from ' + skistats.selectedSkiStrategy().name + '!';
          var twitterButtonHTML = "<a class='twitter-share-button' href='https://twitter.com/share' data-related='maverix7' data-url='http://tgeorgiev.github.io/skistats' data-text='" + text + "' data-size='large'>Tweet</a>";
          
          document.getElementsByClassName('twitter-button-holder')[0].innerHTML = twitterButtonHTML;
          twttr.widgets.load();
        });
      }

      function loadFiles(files, callback) {
        // files is a FileList of File objects. List some properties.
        var filesToLoad = files.length;
        var output = [];
        for (var i = 0; i < files.length; i++) {
            var file = files[i];

            // Only process csv files.
              if (!file.type.match('text/csv')) {
                filesToLoad--;
                continue;
              }

              var reader = new FileReader();

              // Closure to capture the file information.
              reader.onload = function(fileName) {
                return function(e) {
                  skistats.addStat(fileName, e.target.result);
                  filesToLoad--;
                  if (filesToLoad === 0) {
                    callback();
                  }
                };
              }(file.name);

              reader.readAsText(file);
        }
      }

      function handleDragOver(evt) {
        evt.stopPropagation();
        evt.preventDefault();
        evt.dataTransfer.dropEffect = 'copy';
      }
      
      function init() {
        // Setup the dnd listeners.
        var dropZone = document.getElementsByClassName('filesSelectorDrop')[0]
        dropZone.addEventListener('dragover', handleDragOver, false);
        dropZone.addEventListener('drop', handleFileSelect, false);
        
        window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));
      }
    </script>
  </head>
  <body onload="init()">
    <h1>skistats demo</h1>
    
    <p>SkiStats visualizes the raw statistics you have from your ski pass. </p>
    <p>See the <a href="http://tgeorgiev.github.io/skistats">project homepage</a>.
    <p>Check out the <a href="https://github.com/tgeorgiev/skistats">project repo</a>.
    
    <div class="filesSelector">
      <div class="filesSelectorButton">
          <button>Select Files</button>
          <input type="file" id="files" name="files[]" multiple />
      </div>
      <p>or</p>
      <div class="filesSelectorDrop">Drop Files here</div>
      
      <a href="https://github.com/tgeorgiev/skistats"><img style="position: absolute; top: 0; right: 0; border: 0;" src="assets/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
    </div>
    
    <div class="visualization" style="display: none">
      <div class="map">
      </div>
      <div class="legends">
        <div>
          <span class="resortNameHint">Stats for </span><span class="resortName"></span>
        </div>
        <div class="lifts"></div>
        <div class="participants"></div>
      </div>
      <div class="timelineContainer">
      </div>
    </div>
    
  </body>
  
  <footer>
    <div class="twitter-button-holder">
      <a class="twitter-share-button" href="https://twitter.com/share"
        data-related="maverix7"
        data-url="http://tgeorgiev.github.io/skistats"
        data-text="Visualize your Ski Statistics"
        data-size="large">Tweet</a>
    </div>
  </footer>
</html>
